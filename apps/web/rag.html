<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>RAG Admin Portal</title>
  <style>
    body { background:#0b1020; color:#e9ecf8; font:16px Inter, sans-serif; margin:0; padding:20px; }
    h1 { color:#5a7bff; }
    .panel { background:#131a33; border:1px solid #1b2547; border-radius:12px; padding:20px; margin:20px 0; }
    textarea { width:100%; height:120px; margin:10px 0; border-radius:8px; border:1px solid #2b3a6d; background:#0c1430; color:#fff; padding:10px; }
    input[type=file] { margin:10px 0; }
    button { background:#506af7; color:white; border:none; border-radius:8px; padding:8px 16px; cursor:pointer; }
    button:hover { filter:brightness(1.1); }
    .results { margin-top:10px; }
    .chunk { background:#0f1630; border-radius:6px; padding:8px; margin:6px 0; }
  </style>
</head>
<header>
  <div class="bar">
    <div class="brand">Knowledge Upload</div>
    <div class="links">
      <a href="chat.html">Back to Chat</a>
    </div>
  </div>
</header>
<body>
  <h1>General RAG Admin Portal</h1>

  <div class="panel">
    <h2>Paste Text</h2>
    <textarea id="textInput" placeholder="Paste ADHD material here..."></textarea><br>
    <button onclick="uploadText()">Upload Text</button>
  </div>

  <div class="panel">
    <h2>Upload File</h2>
    <input type="file" id="fileInput" />
    <button onclick="uploadFile()">Upload File</button>
  </div>

  <div class="panel">
    <h2>Search RAG</h2>
    <input type="text" id="searchInput" placeholder="Search query..." style="width:70%"/>
    <button onclick="searchRag()">Search</button>
    <div id="searchResults" class="results"></div>
  </div>

  <script>
    const api = "https://adhd-followup-assistant.onrender.com/v1";

    async function uploadText() {
      const text = document.getElementById("textInput").value;
      if (!text) return alert("No text provided");

      try {
        const r = await fetch(api + "/rag/upload_text", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text })
        });
        const d = await r.json();
        if (d.status === "ok") {
          alert(`Uploaded ${d.chunks || 0} chunks successfully`);
        } else {
          alert("Upload failed: " + JSON.stringify(d));
        }
      } catch (err) {
        alert("Error: " + err.message);
      }
    }

    async function uploadFile() {
      const f = document.getElementById("fileInput").files[0];
      if (!f) return alert("No file selected");

      try {
        const form = new FormData();
        form.append("file", f);

        const r = await fetch(api + "/rag/upload_file", {
          method: "POST",
          body: form
        });
        const d = await r.json();
        if (d.status === "ok") {
          alert(`Uploaded ${d.chunks || 0} chunks successfully`);
        } else {
          alert("Upload failed: " + JSON.stringify(d));
        }
      } catch (err) {
        alert("Error: " + err.message);
      }
    }

    async function searchRag() {
      const q = document.getElementById("searchInput").value;
      if (!q) return;

      try {
        const r = await fetch(api + "/rag/search", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ query: q })
        });
        const d = await r.json();
        const res = document.getElementById("searchResults");
        res.innerHTML = "";

        if (d.results && d.results.documents) {
          d.results.documents[0].forEach((ch, idx) => {
            const div = document.createElement("div");
            div.className = "chunk";
            div.textContent = ch;
            res.appendChild(div);
          });
        } else {
          res.textContent = "No results found";
        }
      } catch (err) {
        alert("Error: " + err.message);
      }
    }
  </script>
</body>
</html>
